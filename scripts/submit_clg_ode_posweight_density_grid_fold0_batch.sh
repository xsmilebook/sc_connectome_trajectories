#!/bin/bash

set -euo pipefail

# Minimal grid to test whether BCE pos_weight is forcing p_hat too dense.
# pos_weight ∈ {1,2,5} × lambda_density ∈ {0,0.01,0.05}  => 9 runs

for POS_W in 1 2 5; do
  for LD in 0 0.01 0.05; do
    RUN_BASE="clg_pw${POS_W}_ld${LD}"
    sbatch --export=ALL,CLG_CV_FOLD=0,RUN_BASE="${RUN_BASE}",RESIDUAL_SKIP=1,RESIDUAL_TAU=1.0,RESIDUAL_CAP=0.2,LAMBDA_FULL_LOG_MSE=0.05,EDGE_LOSS=bce,EDGE_POS_WEIGHT="${POS_W}",LAMBDA_ZERO_LOG=0.02,ZERO_LOG_WARMUP_EPOCHS=0,ZERO_LOG_RAMP_EPOCHS=0,LAMBDA_DENSITY="${LD}",DENSITY_WARMUP_EPOCHS=2,DENSITY_RAMP_EPOCHS=20,EARLY_STOP_METRIC=val_sc_log_pearson_sparse,VAL_SC_EVAL_EVERY=1,COMPUTE_MASK_AUPRC=1,ADJACENT_PAIR_PROB=1.0,LATENT_DIM=32,HIDDEN_DIM=64,SOLVER_STEPS=6,MAX_EPOCHS=100,PATIENCE=25,BATCH_SIZE=2,LEARNING_RATE=1e-4,LAMBDA_KL=0,LAMBDA_TOPO=0,LAMBDA_VEL=0,LAMBDA_ACC=0,GRADNORM_SCOPE=none,SC_POS_EDGE_DROP_PROB=0,MORPH_NOISE_SIGMA=0 scripts/submit_clg_ode.sh
  done
done

