# 2026-01-12 会话记录

## 本次目标

- 制定“将 Git 仓库从 `src/` 迁移到项目根目录”的重构计划，并以 `ARCHITECTURE.md` 为结构参考。
- 明确 `.gitignore` 的屏蔽策略，避免将运行时产物（如 `data/`、`outputs/`）纳入版本控制。

## 已完成

- 更新根目录 `PLAN.md`：给出可执行的迁移步骤、校验方式与回滚策略（以 `src.git.bundle` 备份为基础）。
- 更新根目录 `PROGRESS.md`：记录本次计划产出与下一步执行前的确认项。
- 完成迁移执行：根目录已初始化为 Git 仓库，`src/` 不再是独立仓库（已移除 `src/.git`）。
- 迁移前备份：在原 `src/` 仓库创建 annotated tag `pre-root-migration-20260112`，并生成全量 bundle：`src-pre-root-migration-20260112.bundle`。
- 运行时数据整理：将原先带数据集前缀的目录整理为单数据集布局（`data/` 下不再包含 `ABCD/` 这一层），并将图表/结果移动到 `outputs/figures/`、`outputs/results/`。
- 历史导入：将旧 `src/` 仓库的完整提交历史导入根仓库，并统一为 `src/` 前缀路径（通过 `git-filter-repo` 重写后合并）。
- 文档对齐：重写 `docs/workflow.md`、`docs/methods.md`、`docs/data_dictionary.md` 以匹配当前代码与单数据集目录约定。

## 关键约束与假设

- `src/` 当前是独立 Git 仓库（存在 `src/.git`），根目录尚未初始化为 Git 仓库。
- `ARCHITECTURE.md` 作为稳定结构来源；迁移应以“让根目录成为仓库根”为核心，避免不必要的目录改名/重排。
- 不修改 `data/` 与 `outputs/` 下的运行时内容；仅通过 `.gitignore` 保障不提交。

## 待确认问题（执行迁移前）

- 是否需要完整保留 `src/` 的提交历史；若可接受压缩导入（squash）可显著降低迁移复杂度。
- 根目录 `README.md` 与历史 `src/README.md`（当前在 `src` 仓库中处于删除状态）是否需要合并。
- 是否需要扩展忽略规则（如 `.venv/`、`*.ckpt`、`*.pt` 等）。

## 执行结果与注意事项

- 根目录 Git 仓库已包含旧 `src/` 仓库的完整提交历史；为避免历史落在根级路径，先将旧历史重写为 `src/` 子目录前缀再合并。
- 备份 bundle 仍保留用于回滚与二次验证：`src-pre-root-migration-20260112.bundle`。
- 数据整理仅影响本地运行时目录结构；代码与文档中出现的 `data/...` 路径约定以 `docs/workflow.md` 与 `docs/data_dictionary.md` 为准。
