# 2026-01-13 会话记录

## 变更摘要

- 修复 FreeSurfer 重跑场景：当作业意外中断但残留 `scripts/recon-all.done` 导致被试被错误跳过时，允许强制重跑，并在检测到“done 但关键产物缺失”时自动重跑。

## 细节

- `src/preprocess/freesurfer.sh`：
  - 新增环境变量 `FREESURFER_FORCE=1`：提交时可强制删除 `scripts/recon-all.done`（以及可能的 `scripts/IsRunning*`）并重跑。
  - 兼容异常情况：若存在 `scripts/recon-all.done`，但缺失关键产物（例如 `stats/aseg.stats`、`surf/lh.pial`、`surf/rh.pial`），脚本将视为未完成并重跑。

## 使用方式（示例）

```bash
N=$(wc -l < outputs/logs/freesurfer/sublist_freesurfer_from_csv.txt)
sbatch --export=ALL,FREESURFER_FORCE=1 --array=1-${N} src/preprocess/freesurfer.sh outputs/logs/freesurfer/sublist_freesurfer_from_csv.txt
```

